---
output: html_document
runtime: shiny
---

This is a small application intended at illustrating some concepts related to the [Central Limit Theorem](http://www.math.uah.edu/stat/sample/CLT.html).

```{r,echo=F}
library(shiny)
shinyAppDir(getwd(),
            options=list(width="100%",
                         height=1000)) 
```
The idea is quite simple: pick a distribution of choice (**distr**) 
from a drop-down menu, and select the target sample size (**n**) using a slider. The app then shows you two plots:

1. Histogram containing **n** samples from distribution **distr**, overlayed with the theoretical pdf of the selected distribution;  
2. Histogram of 999 mean values of **n** samples from **distr**, overlayed with the best fitting Gaussian.

From these two plots it is possible to observe a few interesting characteristics, such as the Gaussian sample distribution of the means and the decreasing variance of the sample distribution of means.

This app was created using [Shiny](http://shiny.rstudio.com), which is a web application framework for [R](http://www.r-project.org) developed by Winston Chang and the fine folks from [RStudio](http://www.rstudio.com). The source code for the app above is somewhat simple, and consists of two files:

```{r,eval=FALSE}
## ui.R - Defines the user interface
library(shiny)

# Define UI for application that draw the plots to demonstrate the CLT
shinyUI(fluidPage(
      
      # Application title
      titlePanel("Central Limit Theorem - Continuous Distributions"),
      
      # Sidebar with:
      # - A dropdown menu to choose the distribution
      # - A slider to select the sample size for the CLT experiment
      sidebarLayout(
            sidebarPanel(
                  selectInput("distr",
                              "Distribution",
                              choices = c("Beta",
                                          "Chi.squared",
                                          "Exponential",
                                          "F",
                                          "Gamma",
                                          "Lognormal",
                                          "Normal",
                                          "T",
                                          "Uniform",
                                          "Weibull"),
                              selected = "Lognormal"),
                  sliderInput("nobs",
                              "Sample size",
                              min = 10,
                              max = 500,
                              step = 10,
                              value = 30,
                              ticks = F,
                              animate=list(interval=500,loop=F))
            ),
            
            # Show a plot of the generated distribution
            mainPanel(
                  plotOutput("distrPlot"),
                  plotOutput("meansPlot")
            )
      )
))
```

Quite easy, right? The other file is somewhat longer, so be patient (or maybe just skip ahead):

```{r,eval=FALSE}
# Function to plot the original distribution
distrplot<-function(dname,basefunc,nobs,...){
    # Set graphical parameters
    par(las=1,
        tck=.02,
        bg="#EFEFEF")
    
    # Get samples (do a little truncation at the edges to prevent
    # some horrible plot distortions)
    x<-do.call(paste0("r",basefunc),
               list(n=nobs,...))
    x<-pmax(do.call(paste0("q",basefunc),
                    list(p=c(0.01),...)),
            pmin(do.call(paste0("q",basefunc),
                         list(p=c(0.99),...)),
                 x))
    
    # Get histogram
    h<-hist(x,
            breaks = 25,
            freq=T)
    
    h$counts<-h$counts/nobs
    k<-(h$counts/h$density)[1]
    
    # Define plot limits and the points for the theoretical line
    xlim<-range(pretty(
        do.call(paste0("q",basefunc),
                list(p=c(0.01,0.99),...))))
    
    xfit<-seq(xlim[1]+0.01,
              xlim[2]-0.01,
              length.out = 500)
    
    yfit<-k*do.call(paste0("d",basefunc),
                    list(x=xfit,...))
    
    ylim=range(pretty(c(0,1.2*max(yfit))))
    
    # Plot the histogram
    plot(h,
         col = 'cornsilk3', border = 'white',
         xlim = xlim, ylim = ylim,
         main = "", xlab = "", ylab = "",
         axes=F)
    
    # Plot distribution line
    lines(xfit,yfit,
          type = "l",
          col = "cornsilk4",
          lwd=2, 
          lty=1)
    
    # Plot Decorations
    box(which="outer")
    axis(1,at=pretty(xlim))
    axis(2,at=seq(ylim[1],ylim[2],length.out = 5),labels=F)
    legend("topright",
           legend="Theoretical distribution",
           lty=1,lwd=2,col="black")
    title(main=paste("Distribution of samples of",dname,"\n(n =",nobs,")"),
          xlab="x",
          ylab="Frequency")
}

# Function to plot the sampling distribution of means
meansplot<-function(dname,basefunc,nobs,...){
    # Set graphical parameters
    par(las=1,
        tck=.02,
        bg="#EFEFEF")
    
    # Get 999 means of samples of size "nobs"
    x<-colMeans(matrix(do.call(paste0("r",basefunc),
                               list(n=999*nobs,...)),
                       ncol=999))
    
    # Get histogram
    h<-hist(x,
            breaks = 25,
            freq=T)
    
    h$counts<-h$counts/nobs
    k<-(h$counts/h$density)[1]
    
    # Define plot limits and the points for the Gaussian line
    xlim<-range(pretty(
        do.call(paste0("q",basefunc),
                list(p=c(0.01,0.99),...))))
    
    xfit<-seq(xlim[1]+0.01,
              xlim[2]-0.01,
              length.out = 500)
    
    yfit<-k*dnorm(xfit,mean=mean(x),sd=sd(x))
    
    ylim=range(pretty(c(0,1.2*max(yfit))))
    
    # Plot histogram
    plot(h,
         col = 'cornsilk3', border = 'cornsilk4',
         xlim = xlim, ylim = ylim,
         main = "", xlab = "", ylab = "",
         axes=F)
    
    # Plot Gaussian fit
    lines(xfit,yfit,
          type = "l",
          col = "black",
          lwd=3, 
          lty=1)
    
    # Plot decorations
    box(which="outer")
    axis(1,at=pretty(xlim))
    axis(2,at=seq(ylim[1],ylim[2],length.out = 5),labels=F)
    legend("topright",
           legend=c("Best fit",
                    paste0("mu = ",signif(mean(x),3)),
                    paste0("sd = ",signif(sd(x),3))),
           lty=1,lwd=2,
           col=c("black","transparent","transparent"))
    title(main=paste("Distribution of sample means of",dname,"\n for n =",nobs),
          xlab="mean(x)",
          ylab="Frequency")
}

# Define server logic required to draw the two plots to demonstrate the CLT for 
# continuous distributions
shinyServer(function(input, output) {
    output$distrPlot <- renderPlot({
        switch(input$distr,
               Beta             =distrplot(dname="Beta(sh1=0.5,sh2=0.5)",
                                           basefunc="beta",
                                           nobs=input$nobs,
                                           shape1=0.5,
                                           shape2=0.5),
               
               Chi.squared      =distrplot(dname="Chi-squared(df=2)",
                                           basefunc="chisq",
                                           nobs=input$nobs,
                                           df=2),
               
               Exponential      =distrplot(dname="Exponential(rate=1)",
                                           basefunc="exp",
                                           nobs=input$nobs),
               
               F                =distrplot(dname="F(df1=5,df2=10)",
                                           basefunc="f",
                                           nobs=input$nobs,
                                           df1=5,
                                           df2=10),
               
               Gamma            =distrplot(dname="Gamma(shape=1,rate=1)",
                                           basefunc="gamma",
                                           nobs=input$nobs,
                                           shape=1),
               
               Lognormal        =distrplot(dname="Lognormal(mulog=0,sdlog=1)",
                                           basefunc="lnorm",
                                           nobs=input$nobs),
               
               Normal           =distrplot(dname="Normal(mu=0,sd=1)",
                                           basefunc="norm",
                                           nobs=input$nobs),
               
               T                =distrplot(dname="T(df=5)",
                                           basefunc="t",
                                           nobs=input$nobs,
                                           df=5),
               
               Uniform          =distrplot(dname="Uniform(min=0,max=1)",
                                           basefunc="unif",
                                           nobs=input$nobs),
               
               Weibull          =distrplot(dname="Weibull(shape=1,scale=0.5)",
                                           basefunc="weibull",
                                           nobs=input$nobs,
                                           shape=1,
                                           scale=1.5))
    })
    
    output$meansPlot <- renderPlot({
        switch(input$distr,
               Beta             =meansplot(dname="Beta(sh1=0.5,sh2=0.5)",
                                           basefunc="beta",
                                           nobs=input$nobs,
                                           shape1=0.5,
                                           shape2=0.5),
               
               Chi.squared      =meansplot(dname="Chi-squared(df=2)",
                                           basefunc="chisq",
                                           nobs=input$nobs,
                                           df=2),
               
               Exponential      =meansplot(dname="Exponential(rate=1)",
                                           basefunc="exp",
                                           nobs=input$nobs),
               
               F                =meansplot(dname="F(df1=5,df2=10)",
                                           basefunc="f",
                                           nobs=input$nobs,
                                           df1=5,
                                           df2=10),
               
               Gamma            =meansplot(dname="Gamma(shape=1,rate=1)",
                                           basefunc="gamma",
                                           nobs=input$nobs,
                                           shape=1),
               
               Lognormal        =meansplot(dname="Lognormal(mulog=0,sdlog=1)",
                                           basefunc="lnorm",
                                           nobs=input$nobs),
               
               Normal           =meansplot(dname="Normal(mu=0,sd=1)",
                                           basefunc="norm",
                                           nobs=input$nobs),
               
               T                =meansplot(dname="T(df=5)",
                                           basefunc="t",
                                           nobs=input$nobs,
                                           df=5),
               
               Uniform          =meansplot(dname="Uniform(min=0,max=1)",
                                           basefunc="unif",
                                           nobs=input$nobs),
               
               Weibull          =meansplot(dname="Weibull(shape=1,scale=0.5)",
                                           basefunc="weibull",
                                           nobs=input$nobs,
                                           shape=1,
                                           scale=1.5))
    })
    
})
```

Easy, right? ;-)

By the way, this page was also implemented in RStudio, using their [R Markdown](http://rmarkdown.rstudio.com) capabilities to convert my code into a simple, human-readable report.

I hope you enjoy this little demo. This is my very first shiny app, so comments, suggestions and (preferrably constructive) criticism are all very welcome.

Cheers,  
Felipe

